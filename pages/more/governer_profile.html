<!DOCTYPE html>
<!-- Created By CodingNepal -->
<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <title>mla profile</title>
    <link rel="stylesheet" href="../../assets/css/main.css">

    <link href="../../assets/css/main.css" rel="stylesheet">

    <link rel="icon" type="image/jpg" sizes="60x32" href="../../assets/images/icons/p logo.jpg">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <link rel="stylesheet" href="../../assets/css/leader_profile.css">

    <link rel="stylesheet" href="../../assets/css/footer.css">

    <script src="https://cdn.jsdelivr.net/npm/vivus@0.4.5/dist/vivus.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12/lib/typed.min.js"></script>


    <style>
        #Layer_1 {
            max-width: 300px;
            min-width: 50px;
            margin: auto;
            height: 400px;
        }
    </style>

</head>

<body>
    <div class="wrapper">
        <nav id="sidebar">
            <ul>

            </ul>
        </nav>
    </div>
    <div class="content">

        <div class="headprofile">

        </div>

        <!-- cm content page  -->

        <div class="cm-total-content">



        </div>

        <h1 class="cmd">கருத்துப் பகுதி</h1>
        <ul id="comments-list">கருத்து</ul>
        <form id="comment-form">
            <label for="comment"></label>
            <textarea id="comment" required></textarea>
            <br>
            <p id="information">Login and then try comment Thank you</p>
            <input type="submit" id="submit_btn" value="Submit">
        </form>

    </div>


    <script src="../../assets/javascript/governer_profile.js"></script>

    <script src="../../main.js"></script>

    <script>
     


        function handleFormSubmit(event) {
            event.preventDefault();

            const users = JSON.parse(localStorage.getItem("users"));

            const minister = JSON.parse(localStorage.getItem("governor_details"));

            const loginEmail = localStorage.getItem("profile_email");

            const currentUser = users.find(user => user.email === loginEmail);

            const currentUserName = currentUser.first_name;

            const url = window.location.search;

            const urlParams = new URLSearchParams(url);

            const username = urlParams.get("name");

            const ministerId = minister.find(m => m.id === username).id;

            const comment = document.getElementById("comment").value;

            const timestamp = new Date().getTime();

            const commentObject = {

                user_id: currentUserName,
                comment,
                timestamp,
                ministerId,
            };

            const comments = JSON.parse(localStorage.getItem("comments")) ?? [];
            comments.push(commentObject);
            localStorage.setItem("comments", JSON.stringify(comments));

            const filteredComments = comments.filter(
                comment_id => comment_id.id === username
            );
            displayComments(filteredComments)

            document.getElementById("comment-form").reset();
        }

        function displayComments() {

            const comments1 = JSON.parse(localStorage.getItem("comments")) ?? [];

            const minister = JSON.parse(localStorage.getItem("governor_details"))

            const url = window.location.search;

            const urlParams = new URLSearchParams(url);

            const username = urlParams.get("name");

            const commentsList = document.getElementById("comments-list");

            commentsList.innerHTML = "";

            comments1.forEach(comment => {

                if (comment.ministerId === username) {

                    const li = document.createElement("li");
                    const date = new Date(comment.timestamp).toLocaleString();
                    li.innerHTML = `<strong>${comment.user_id}</strong> said on ${date}:<br>${comment.comment}`;
                    commentsList.appendChild(li);
                }
            });

        }

        document.getElementById('comment-form').addEventListener('submit', handleFormSubmit)

        window.onload = displayComments;


        const submit_btn = document.getElementById("submit_btn");

        const loginEmail = localStorage.getItem("profile_email");

        const information = document.getElementById("information");


        if (loginEmail !== null) {
            submit_btn.style.display = "block"

            information.style.display = "none"
        } else {
            submit_btn.style.display = "none"

            information.style.display = "block"
        }

    </script>

    <!-- script for bootstrap -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>


    <!-- script for bootstrap -->
</body>

</html>